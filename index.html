<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shivam Jee Milk Dairy</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{margin:0;font-family:Arial;background:#eee}
marquee{font-size:22px;font-weight:bold;color:green;background:#fff;padding:10px}
.app{max-width:430px;margin:auto;background:#fff;min-height:100vh;padding:10px}
input,select,button{width:100%;padding:10px;margin:6px 0}
button{border:none;border-radius:6px;color:#fff}
.green{background:green}
.blue{background:#0b5ed7}
.red{background:red}
.card{background:#f1f1f1;padding:10px;border-radius:8px;margin-top:10px}
img{width:100%;border-radius:8px;margin-top:5px}
table{width:100%;border-collapse:collapse;font-size:12px;margin-top:10px}
th,td{border:1px solid #000;padding:4px;text-align:center}
.hidden{display:none}
.center{text-align:center}
</style>
</head>

<body>

<!-- üî¥ WELCOME SCROLL -->
<marquee behavior="scroll" direction="left">
üåü WELCOME TO SHIVAM JEE MILK DAIRY üåü
</marquee>

<!-- LOGIN -->
<div class="app" id="loginBox">
<h3 class="center">üîê Login</h3>
<input id="user" value="Shivam Yadav">
<input id="pass" type="password" value="277210">
<button class="green" onclick="login()">Login</button>
</div>

<!-- MAIN APP -->
<div class="app hidden" id="mainApp">

<h3 class="center">üêÑ Shivam Jee Milk Dairy üêÉ</h3>

<h4>‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h4>
<input id="cname" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ">
<input id="cvillage" placeholder="‡§ó‡§æ‡§Å‡§µ">
<select id="cmilk">
<option value="">‡§¶‡•Ç‡§ß ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</option>
<option>‡§ó‡§æ‡§Ø</option>
<option>‡§≠‡•à‡§Ç‡§∏</option>
</select>

<!-- üì∑ DIRECT CAMERA -->
<input type="file" id="cphoto" accept="image/*" capture="environment">

<button class="green" onclick="addCustomer()">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>

<hr>

<h4>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç</h4>
<select id="customerList" onchange="selectCustomer()"></select>
<button class="red" onclick="deleteCustomer()">‡§™‡•Ç‡§∞‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï Delete</button>

<div id="customerBox"></div>

<hr>

<h4>‡§Ü‡§ú ‡§ï‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä</h4>
<input type="date" id="date">
<input type="number" id="liter" placeholder="‡§≤‡•Ä‡§ü‡§∞">
<input type="number" id="rate" placeholder="‚Çπ ‡§™‡•ç‡§∞‡§§‡§ø ‡§≤‡•Ä‡§ü‡§∞">
<input id="total" placeholder="‡§ï‡•Å‡§≤ ‚Çπ" readonly>
<input type="number" id="paid" placeholder="‡§Ü‡§ú ‡§¶‡§ø‡§Ø‡§æ ‚Çπ">
<button class="green" onclick="saveEntry()">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>

<div class="card" id="summary"></div>

<button class="blue" onclick="downloadPDF()">PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§°</button>
<button class="blue" onclick="sendWhatsApp()">WhatsApp ‡§≠‡•á‡§ú‡•á‡§Ç</button>
<button class="red" onclick="logout()">Logout</button>

<table id="table"></table>

</div>

<script>
// LOGIN CHECK
if(localStorage.getItem("login")==="yes"){
 loginBox.classList.add("hidden");
 mainApp.classList.remove("hidden");
}

function login(){
 if(user.value==="Shivam Yadav" && pass.value==="277210"){
  localStorage.setItem("login","yes");
  loginBox.classList.add("hidden");
  mainApp.classList.remove("hidden");
 }
}
function logout(){
 localStorage.removeItem("login");
 location.reload();
}

// DATA
let customers = JSON.parse(localStorage.getItem("customers")) || [];
let current=null;

rate.oninput=liter.oninput=()=>{
 total.value=(rate.value||0)*(liter.value||0);
};

function saveData(){
 localStorage.setItem("customers",JSON.stringify(customers));
 loadCustomerList();
}

function addCustomer(){
 let f=cphoto.files[0];
 if(!cname.value||!f){alert("‡§∏‡§≠‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç");return;}
 let r=new FileReader();
 r.onload=()=>{
  customers.push({
   name:cname.value,
   village:cvillage.value,
   milk:cmilk.value,
   photo:r.result,
   entries:[]
  });
  saveData();
 };
 r.readAsDataURL(f);
}

function loadCustomerList(){
 customerList.innerHTML="<option>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç</option>";
 customers.forEach((c,i)=>{
  let o=document.createElement("option");
  o.value=i;
  o.text=c.name+" ("+c.village+")";
  customerList.add(o);
 });
}

function selectCustomer(){
 current=customerList.value;
 let c=customers[current];
 customerBox.innerHTML=
 `<div class="card"><b>${c.name}</b><br>${c.village}<br>${c.milk}
 <img src="${c.photo}"></div>`;
 loadTable();
}

function saveEntry(){
 let c=customers[current];
 c.entries.push({
  date:date.value,
  liter:+liter.value,
  rate:+rate.value,
  total:+total.value,
  paid:+paid.value
 });
 saveData(); loadTable();
}

function loadTable(){
 let c=customers[current];
 let t=0,p=0;
 table.innerHTML="<tr><th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th><th>‡§≤‡•Ä‡§ü‡§∞</th><th>‚Çπ</th><th>Paid</th><th>Due</th><th>‚ùå</th></tr>";
 c.entries.forEach((e,i)=>{
  t+=e.total; p+=e.paid;
  let r=table.insertRow();
  r.insertCell(0).innerText=e.date;
  r.insertCell(1).innerText=e.liter;
  r.insertCell(2).innerText=e.total;
  r.insertCell(3).innerText=e.paid;
  r.insertCell(4).innerText=e.total-e.paid;
  r.insertCell(5).innerHTML=`<button class="red" onclick="delEntry(${i})">X</button>`;
 });
 summary.innerHTML=`<b>Total ‚Çπ:</b> ${t}<br><b>Paid ‚Çπ:</b> ${p}<br><b>Baki ‚Çπ:</b> ${t-p}`;
}

function delEntry(i){
 customers[current].entries.splice(i,1);
 saveData(); loadTable();
}

function deleteCustomer(){
 if(confirm("‡§™‡•Ç‡§∞‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï delete ‡§π‡•ã ‡§ú‡§æ‡§è‡§ó‡§æ")){
  customers.splice(current,1);
  saveData();
  customerBox.innerHTML=""; table.innerHTML=""; summary.innerHTML="";
 }
}

function downloadPDF(){
 const {jsPDF}=window.jspdf;
 let pdf=new jsPDF(),y=10;
 let c=customers[current];
 pdf.text("Shivam Jee Milk Dairy",10,y); y+=10;
 pdf.text(c.name+" ("+c.village+")",10,y); y+=8;
 c.entries.forEach(e=>{
  pdf.text(`${e.date} | ‚Çπ${e.total} | Paid ‚Çπ${e.paid}`,10,y); y+=6;
 });
 pdf.save(c.name+".pdf");
}

function sendWhatsApp(){
 let c=customers[current];
 let msg=`${c.name}%0A`;
 c.entries.forEach(e=>{
  msg+=`${e.date} ‚Çπ${e.total} Paid ‚Çπ${e.paid}%0A`;
 });
 window.open(`https://wa.me/?text=${msg}`);
}

loadCustomerList();
</script>

</body>
 </html>
