<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shivam Jee Milk Dairy</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
body{margin:0;font-family:Arial;background:#eee}
.app{max-width:450px;margin:auto;background:#fff;min-height:100vh;padding:10px}
input,select,button{width:100%;padding:10px;margin:6px 0;font-size:14px}
button{border:none;border-radius:6px;color:#fff;cursor:pointer}
.green{background:green}
.blue{background:#0b5ed7}
.red{background:red}
.card{background:#f1f1f1;padding:10px;border-radius:8px;margin-top:10px}
img{width:100%;border-radius:8px;margin-top:5px}
table{width:100%;border-collapse:collapse;font-size:12px;margin-top:10px}
th,td{border:1px solid #000;padding:4px;text-align:center}
.hidden{display:none}
.center{text-align:center}
</style>
</head>
<body>

<!-- WELCOME SLIDE -->
<div class="app" id="welcomePage">
<h2 class="center">üåü Welcome to Shivam Jee Milk Dairy üåü</h2>
<button class="green" onclick="showLogin()">Proceed to Login</button>
</div>

<!-- LOGIN -->
<div class="app hidden" id="loginPage">
<h3 class="center">üîê Login</h3>
<input id="loginUser" value="Shivam Yadav">
<input id="loginPass" type="password" value="277210">
<button class="green" onclick="login()">Login</button>
</div>

<!-- MAIN APP -->
<div class="app hidden" id="mainApp">

<h3 class="center">üêÑ Shivam Jee Milk Dairy üêÉ</h3>

<!-- ADD CUSTOMER -->
<h4>‡§®‡§Ø‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ú‡•ã‡§°‡§º‡•á‡§Ç</h4>
<input id="cname" placeholder="‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ï‡§æ ‡§®‡§æ‡§Æ">
<input id="cvillage" placeholder="‡§ó‡§æ‡§Å‡§µ">
<select id="cmilk">
<option value="">‡§¶‡•Ç‡§ß ‡§ï‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</option>
<option>‡§ó‡§æ‡§Ø</option>
<option>‡§≠‡•à‡§Ç‡§∏</option>
</select>
<input type="file" id="cphoto" accept="image/*">
<button class="green" onclick="addCustomer()">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>

<hr>

<!-- SELECT CUSTOMER -->
<h4>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç</h4>
<select id="customerSelect" onchange="selectCustomer()"></select>
<button class="red" onclick="deleteCustomer()">‡§™‡•Ç‡§∞‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï Delete</button>

<div id="customerBox"></div>

<hr>

<h4>‡§Ü‡§ú ‡§ï‡•Ä ‡§è‡§Ç‡§ü‡•ç‡§∞‡•Ä</h4>
<input type="date" id="date">
<input id="qty" type="number" placeholder="‡§≤‡•Ä‡§ü‡§∞">
<input id="rate" type="number" placeholder="‡§∞‡•á‡§ü ‚Çπ/‡§≤‡•Ä‡§ü‡§∞">
<input id="total" readonly placeholder="‡§ï‡•Å‡§≤ ‚Çπ">
<input id="paid" type="number" placeholder="‡§Ü‡§ú ‡§¶‡§ø‡§Ø‡§æ ‚Çπ">
<button class="green" onclick="saveEntry()">‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç</button>

<div class="card" id="summary"></div>

<button class="blue" onclick="downloadPDF()">PDF ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§ï‡§∞‡•á‡§Ç</button>
<button class="blue" onclick="sendWhatsApp()">WhatsApp ‡§≠‡•á‡§ú‡•á‡§Ç</button>
<button class="red" onclick="logout()">Logout</button>

<table id="table"></table>

</div>

<script>
// WELCOME
function showLogin(){
 welcomePage.classList.add("hidden");
 loginPage.classList.remove("hidden");
}

// LOGIN
function login(){
 if(loginUser.value==="Shivam Yadav" && loginPass.value==="277210"){
  localStorage.setItem("logged","yes");
  loginPage.classList.add("hidden");
  mainApp.classList.remove("hidden");
 }
}
function logout(){
 localStorage.removeItem("logged");
 location.reload();
}
if(localStorage.getItem("logged")==="yes"){
 welcomePage.classList.add("hidden");
 loginPage.classList.add("hidden");
 mainApp.classList.remove("hidden");
}

// DATA
let customers = JSON.parse(localStorage.getItem("customers")) || [];
let currentIndex=null;
rate.oninput=qty.oninput=()=>{ total.value=(rate.value||0)*(qty.value||0); };

// ADD CUSTOMER
function addCustomer(){
 let f=cphoto.files[0];
 if(!f || !cname.value){ alert("‡§∏‡§≠‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§≠‡§∞‡•á‡§Ç"); return; }
 let r=new FileReader();
 r.onload=()=>{
  customers.push({name:cname.value,village:cvillage.value,milk:cmilk.value,photo:r.result,entries:[]});
  save();
 };
 r.readAsDataURL(f);
}

// SAVE TO LOCALSTORAGE
function save(){ localStorage.setItem("customers",JSON.stringify(customers)); loadCustomerList(); }

// LOAD CUSTOMER LIST
function loadCustomerList(){
 customerSelect.innerHTML="<option>‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç</option>";
 customers.forEach((c,i)=>{
  let o=document.createElement("option");
  o.value=i; o.text=c.name+" ("+c.village+")";
  customerSelect.add(o);
 });
}

// SELECT CUSTOMER
function selectCustomer(){
 currentIndex=customerSelect.value;
 let c=customers[currentIndex];
 customerBox.innerHTML=`<div class="card"><b>${c.name}</b><br>${c.village}<br>${c.milk}<img src="${c.photo}"></div>`;
 loadTable();
}

// SAVE ENTRY
function saveEntry(){
 if(currentIndex===null){alert("‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç"); return;}
 let c=customers[currentIndex];
 c.entries.push({date:date.value,qty:+qty.value,rate:+rate.value,total:+total.value,paid:+paid.value});
 save(); loadTable();
}

// LOAD TABLE + SUMMARY
function loadTable(){
 if(currentIndex===null) return;
 let c=customers[currentIndex];
 let t=0,p=0;
 table.innerHTML="<tr><th>‡§§‡§æ‡§∞‡•Ä‡§ñ</th><th>‡§≤‡•Ä‡§ü‡§∞</th><th>‚Çπ</th><th>Paid</th><th>Due</th><th>‚ùå</th></tr>";
 c.entries.forEach((e,i)=>{
  t+=e.total; p+=e.paid;
  let r=table.insertRow();
  r.insertCell(0).innerText=e.date;
  r.insertCell(1).innerText=e.qty;
  r.insertCell(2).innerText=e.total;
  r.insertCell(3).innerText=e.paid;
  r.insertCell(4).innerText=e.total-e.paid;
  r.insertCell(5).innerHTML=`<button class="red" onclick="delEntry(${i})">X</button>`;
 });
 summary.innerHTML=`<b>Total ‚Çπ:</b> ${t}<br><b>Paid ‚Çπ:</b> ${p}<br><b>Baki ‚Çπ:</b> ${t-p}`;
}

// DELETE ENTRY
function delEntry(i){ customers[currentIndex].entries.splice(i,1); save(); loadTable(); }

// DELETE CUSTOMER
function deleteCustomer(){
 if(currentIndex===null){alert("‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç");return;}
 if(confirm("‡§™‡•Ç‡§∞‡§æ ‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§π‡§ü ‡§ú‡§æ‡§è‡§ó‡§æ?")){
  customers.splice(currentIndex,1); save();
  customerBox.innerHTML=""; table.innerHTML=""; summary.innerHTML=""; loadCustomerList();
 }
}

// PDF
function downloadPDF(){
 if(currentIndex===null){alert("‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç"); return;}
 const {jsPDF}=window.jspdf; let pdf=new jsPDF(); let y=10;
 let c=customers[currentIndex];
 pdf.text("Shivam Jee Milk Dairy",10,y); y+=10;
 pdf.text(`${c.name} (${c.village})`,10,y); y+=8;
 c.entries.forEach(e=>{
  pdf.text(`${e.date} | ${e.qty}L | ‚Çπ${e.total} | Paid ‚Çπ${e.paid} | Due ‚Çπ${e.total-e.paid}`,10,y); y+=6;
 });
 pdf.save(`${c.name}_Milk_Report.pdf`);
}

// WhatsApp
function sendWhatsApp(){
 if(currentIndex===null){alert("‡§ó‡•ç‡§∞‡§æ‡§π‡§ï ‡§ö‡•Å‡§®‡•á‡§Ç"); return;}
 let c=customers[currentIndex]; let msg=`${c.name} (${c.village})%0A`;
 c.entries.forEach(e=>{
  msg+=`${e.date} ${e.qty}L ‚Çπ${e.total} Paid ‚Çπ${e.paid} Due ‚Çπ${e.total-e.paid}%0A`;
 });
 window.open(`https://wa.me/?text=${msg}`);
}

loadCustomerList();
</script>
</body>
 </html>
